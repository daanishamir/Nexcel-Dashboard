<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Agent Details</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background-color: #000;
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    body {
    font-family: 'Poppins', sans-serif;
    background: #000 url(data:image/png;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCAAyADIDAREAAhEBAxEB/8QAGQABAQEAAwAAAAAAAAAAAAAAAAQGBQkK/8QAJRAAAgIBAwMFAQEAAAAAAAAAAwQAAgUBBgcVNFQTdJSz0xQR/8QAGwEBAQEBAQADAAAAAAAAAAAAAAUDBwYECAr/xAAsEQABBAECAA8BAQAAAAAAAAADAAIEBQEGBxIUFTQ1VFVzdZOVsrTS0xMR/9oADAMBAAIRAxEAPwDwQZvPZl/LPtNZJojBGL1MapNQ3YuH/A6tNah9P+p9r0/6MjkWPVfyj5WclkmW8g200aZAroMaHHCGKFomixljMt4bRNf/AKTAQ4Jwv4xg8L+UWKLgR4cdgosUQYwRCZ7jVustVXOpLmxsb6xPOPNIyVKZIdFLNLFw2I6wsHRP4coXNh/DE28vJuJFzqK5kTr6+nWV3ZWFhJ4vqWR8935R/wBJ8zisbq4PJH9V53l+97atvUZn7J1LI+e78o/6RxWN1cHkj+qcv3vbVt6jM/ZOpZHz3flH/SOKxurg8kf1Tl+97atvUZn7J1LI+e78o/6RxWN1cHkj+qcv3vbVt6jM/ZOpZHz3flH/AEjisbq4PJH9U5fve2rb1GZ+y1a3IW4VVwLUU2cWi4RAoVzjnjzIOEqKlR1I2+/tdl55m+ldLHccYO2yXW5mDFNe97Ri6arTFIVxrxjikeRzAao1NGA3L3ZdloY0e3FHjibnP+DAAQwiZjAxDYxrW46RB3w1xXwocAVdtdJFBix4YpFrsVshd2ZxxgsCw1jc3G3k+3t55Wsw+ZZ2s6ZZT5DiSp0uRKKUz8k/3zvu2fuvLUfm4O5F7Grmdz0xa+JTvlFUk2U1IRIRIRIRIRVv9877tn7rzGPzcHci9jVSuemLXxKd8oqkmympCJCJCJCJCKt/vnfds/deYx+bg7kXsaqVz0xa+JTvlFUk2U1IRIRIRIRIRVv9877tn7rzGPzcHci9jVSuemLXxKd8oqkmympCJCJCJCJCKt/vnfds/deYx+bg7kXsaqVz0xa+JTvlFUk2U1IRIRIRIRIRbbkBZdXPJUWAFehdmcbuFoAVBVI5kOO9rPvtEqOtdLsvPMsOOHtpqVls5mDXuYt72gabKU1dIcUhCuZe6pAxxHufloI2p7ePGC3Ls5y0UeOIQADx/jBBGMQ8NYxrcda3qgwq/WVUKBDiwRSdqth7WQKHHDGGezu9jtu7i5sTMCxjSz7e3nzrWzmPw6RPspkudKIWVIMV+Jl9clSESESESEXbfxtxtx09x1sF57YOynHXNlbWacca2tg2GmmmMGiZhllgyFynYOW9ymMW9iFJa172ta2uuv0v1TqnU8fU+o48fUd8AAL63CAAbewEEIRWEhgxCGyQ1gxjY1rGMY3DWNxhrcYxjGF+mXYbYbY242N2Yt7fZjae0tbTafbqxs7Ox260hOsLGwnaQp5M2fPmyacsmZNmSSlkSpUgpDyDkIUpHke52f/Z) repeat;
    color: #ffffff;
    display: flex;
    justify-content: center;
    align-items: center;

    overflow: hidden;
   
  
  
    /* Background Animation */
    animation: bg-scrolling-reverse 1s linear infinite;
  }
  
  @keyframes bg-scrolling {
    0% {
      background-position: 50px 50px;
    }
  }
  
  @keyframes bg-scrolling-reverse {
    100% {
      background-position: 50px 50px;
    }
  }
    
    .agent-rectangle {
      background: radial-gradient(circle, #ff0000 0%, #8b0000 100%);
      width: 93%;
      height: 350px;
      margin-top: 20px;
      position: relative;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .agent-name {
      position: absolute;
      top: 10px;
      left: 20px;
      font-size: 150px;
      font-weight: bold;
      line-height: 1;
    }
    .agent-name span {
      display: block;
    }
    .agent-photo {
      position: absolute;
      top: 10px;
      right: 20px;
      width: 500px;
      height: 500px;
      background-size: cover;
      background-position: center;
    }
    .bottom-info {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
      width: 95%;
      padding: 10px;
    }
    .info-box, .sales-chart-box {
      background-color: #11111173;
      padding: 20px;
      border-radius: 10px;
      width: 48%;
    }
    .info-box div {
      margin-bottom: 10px;
      font-size: 32px;
    }
    .info-label {
  font-weight: normal !important;
  font-size: 18px !important;
}


    .info-value {
      color: #ff4444;
      margin-left: 5px;
    }

    .info-section {
  margin-bottom: 20px;
}

.info-section .info-label {
  font-size: 20px;
  font-weight: 600;
  margin-bottom: 5px;
}

.info-section .info-value {
  font-size: 36px;
  font-weight: bold;
  color: #ff4444;
}

    .comparison {
      font-size: 20px;
      margin-left: 10px;
    }
    .footer {
    position: fixed;
    bottom: 20px; /* Move it slightly up from the bottom */
    right: 20px;  /* Adjust the distance from the right edge */
    margin: 0; /* No need for extra margin */
    font-family: 'Poppins', sans-serif;
    font-weight: 300; /* Light version of Poppins */
    font-size: 14px;
    color: #ffffff86; /* Adjust color as needed */
}
.agent-description {
  font-size: 20px;
  color: #ffffff;
  margin-top: 5px;
  text-align: left;
  width: 100%;
  padding-left: 10px;
  font-style: normal;
  font-weight: normal; /* <-- This is important for not bold */
}

    canvas {
      background: #111;
      border-radius: 10px;
      padding: 10px;
    }
    .month-comparison {
      width: 93%;
      background-color: #111;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      font-size: 24px;
      text-align: center;
    }
    .positive { color: #4CAF50; }
    .negative { color: #F44336; }
    .neutral  { color: #FFC107; }
  </style>
</head>

<body>

  <div class="agent-rectangle">
    <div class="agent-name">
      <span id="agentFirstName"></span>
      <span id="agentLastName"></span>
    </div>
    <div class="agent-photo" id="agentPhoto"></div>
  </div>


  <div class="bottom-info">
    <div class="info-box">
      <div class="info-section">
        <div class="info-label">Total Sales</div>
        <div>
          <span class="info-value" id="totalSales">0</span>
          <span class="comparison" id="totalSalesDiff"></span>
        </div>
      </div>
  
      <div class="info-section">
        <div class="info-label">Average Sales</div>
        <div>
          <span class="info-value" id="avgSales">0</span>
          <span class="comparison" id="avgSalesDiff"></span>
        </div>
      </div>
  
      <div class="info-section">
        <div class="info-label">Leaves</div>
        <div>
          <span class="info-value" id="leave">0</span>
          <span class="comparison" id="leaveDiff"></span>
        </div>
      </div>
  
      <div class="info-section">
        <div class="info-label">Days on Zero</div>
        <div>
          <span class="info-value" id="zeroDays">0</span>
          <span class="comparison" id="zeroDaysDiff"></span>
        </div>
      </div>
  
      <div class="info-section">
        <div class="info-label">QA Issue</div>
        <div>
          <span class="info-value" id="qaIssue">0</span>
          <span class="comparison" id="qaIssueDiff"></span>
        </div>
      </div>
    </div>
  
    <div class="sales-chart-box">
      <canvas id="agentChart" width="400" height="200"></canvas>
    </div>
  </div>

  <script>
    const SHEET_ID = '1agBmRpPSA3QnlfqWBgEe_5HUR5Y4Q695XDEwKKfmAso';
    const SHEET_NAME = 'AAA-Monthly!A2:AK';
    const API_KEY = 'AIzaSyDvY9b78JMeGlobtLm3VshDjIH67yypjvk';

    const params = new URLSearchParams(window.location.search);
    const agentName = params.get('name') || 'Ali Raza';

    async function fetchAgentData() {
  try {
    const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
    const response = await fetch(url);
    const data = await response.json();
    const rows = data.values || [];

    const normalizeName = (name) => name.trim().toLowerCase();
    const agentData = rows.find(row => normalizeName(row[0]) === normalizeName(agentName));

    if (agentData) {
      const totalSales = parseInt(agentData[1]) || 0;
      const avgSales = parseFloat(agentData[2]) || 0;
      const workingDays = parseInt(agentData[3]) || 0;
      const zeroDays = parseInt(agentData[4]) || 0;
      const qaIssue = parseInt(agentData[36]) || 0;
      const description = agentData[37] || '';

      // Split agentName into first and last names
      const nameParts = agentName.split(' ');
      document.getElementById('agentFirstName').textContent = nameParts[0] || '';
document.getElementById('agentLastName').textContent = nameParts[1] || '';

if (description) {
  const descElement = document.createElement('div');
  descElement.classList.add('agent-description');
  descElement.textContent = description;
  document.getElementById('agentFirstName').parentNode.appendChild(descElement);
}
      document.getElementById('totalSales').textContent = totalSales;
      document.getElementById('avgSales').textContent = avgSales;
      document.getElementById('leave').textContent = workingDays;
      document.getElementById('zeroDays').textContent = zeroDays;
      document.getElementById('qaIssue').textContent = qaIssue;

      const agentPhotoUrl = `./image/${agentName}.png`;
      document.getElementById('agentPhoto').style.backgroundImage = `url('${agentPhotoUrl}')`;

      const days = Array.from({ length: 31 }, (_, i) => i + 1);
      const salesData = agentData.slice(5, 5 + 31).map(x => parseInt(x) || 0);

      const ctx = document.getElementById('agentChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: days,
          datasets: [{
            label: 'Daily Sales',
            data: salesData,
            backgroundColor: 'rgba(255, 68, 68, 0.2)',
            borderColor: 'rgba(255, 68, 68, 1)',
            borderWidth: 2,
            pointBackgroundColor: 'white',
            tension: 0.4
          }]
        },
        options: {
          scales: {
            x: {
              ticks: { color: 'white' },
              grid: { color: '#333' }
            },
            y: {
              ticks: { color: 'white' },
              grid: { color: '#333' }
            }
          },
          plugins: {
            legend: {
              labels: { color: 'white' }
            }
          }
        }
      });

      await fetchPreviousMonthData(agentName, { totalSales, avgSales, workingDays, zeroDays, qaIssue });
    } else {
      document.querySelector('.agent-rectangle').innerHTML = `<p style="color: red;">Agent not found in the sheet.</p>`;
    }

  } catch (error) {
    console.error('Error fetching agent data:', error);
  }
}

async function fetchPreviousMonthData(agentName, currentData) {
  try {
    const now = new Date();
    const prevMonthDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
    const prevMonth = prevMonthDate.getMonth() + 1;
    const prevYear = prevMonthDate.getFullYear();

    const filename = `sales-${prevYear}-${String(prevMonth).padStart(2, '0')}.json`;
    const githubUrl = `https://raw.githubusercontent.com/daanishamir/AAA-Sales-Data/main/${filename}`;

    const response = await fetch(githubUrl);
    if (!response.ok) throw new Error(`Previous month data not found (${response.status})`);

    const jsonData = await response.json();
    const agentsArray = Array.isArray(jsonData.agents) ? jsonData.agents : [];

    const prevAgent = agentsArray.find(agent => agent && agent.name && agent.name.toLowerCase() === agentName.toLowerCase());
    if (!prevAgent) throw new Error(`No data for agent "${agentName}"`);

    const prevData = {
      totalSales: parseInt(prevAgent.total_sales || 0),
      avgSales: parseFloat(prevAgent.avg_sales || 0),
      workingDays: parseInt(prevAgent.working_days || 0),
      zeroDays: parseInt(prevAgent.zero_days || 0),
      qaIssue: parseInt(prevAgent.qa_issue || 0)
    };

    // Correct comparison logic
    function updateComparison(elementId, currentValue, previousValue, positiveIfLower = false) {
  const diffElement = document.getElementById(elementId);
  if (!diffElement) return;

  let isPositive;
  if (positiveIfLower) {
    isPositive = currentValue < previousValue; // Lower is better
  } else {
    isPositive = currentValue > previousValue; // Higher is better
  }

  const arrow = isPositive ? '▲' : '▼';
  const colorClass = isPositive ? 'positive' : 'negative';

  // Only show arrow + previous value
  diffElement.innerHTML = `
    <span class="${colorClass}">${arrow} ${previousValue}</span>
  `;
}
    // Apply to all fields:
    updateComparison('totalSalesDiff', currentData.totalSales, prevData.totalSales); // Higher is better
    updateComparison('avgSalesDiff', currentData.avgSales, prevData.avgSales);       // Higher is better
    updateComparison('leaveDiff', currentData.workingDays, prevData.workingDays, true); // Lower leaves = better
    updateComparison('zeroDaysDiff', currentData.zeroDays, prevData.zeroDays, true);    // Lower zero days = better
    updateComparison('qaIssueDiff', currentData.qaIssue, prevData.qaIssue, true);        // Lower QA issues = better

    // Month comparison (for total sales)
    const monthName = prevMonthDate.toLocaleString('default', { month: 'short' });
    const monthArrow = currentData.totalSales >= prevData.totalSales ? '▲' : '▼';
    const monthColor = currentData.totalSales >= prevData.totalSales ? 'positive' : 'negative';

    document.getElementById('monthComparison').innerHTML = `
      <span class="${monthColor}">
        ${currentData.totalSales} ${monthArrow} ${prevData.totalSales} sales
        vs ${monthName} ${prevYear}
      </span>
    `;

  } catch (error) {
    console.error('Error fetching previous month data:', error);
    document.getElementById('monthComparison').innerHTML = `<span class="neutral">${error.message}</span>`;
  }
}

    document.addEventListener('DOMContentLoaded', fetchAgentData);
    
  </script>
<h1 class="footer">Created and Designed by daanishamir</h1>
</body>
</html>
